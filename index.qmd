---
logo: "img/wtf-logo-square-transparent.png"
format: 
  revealjs: 
    theme: [night, slides.scss]
    highlight-style: a11y
    transition: fade
    slide-number: true
    chalkboard: true
    navigation-mode: linear
    controls: false
    mermaid-format: svg
execute:
  freeze: auto
from: markdown+emoji
---

# Using Version Control {background-image="img/forks.jpg"}

## imagine we need to work on a paper together 

how should we do that?  

## key questions

- which version of the document is the authoritative one?  
- if you and I change the same thing:
  - how will we know we did that?
  - whose edits should win?

## some solutions

::: fragment
::: {layout-nrow=1}
![dropbox](img/dropbox.svg){width=20%}
![shared drive](img/fileserver.svg){width=20%}
![email](img/email.png){width=20%}
![google docs](img/googledocs.svg){width=20%}
:::
:::

::: notes
let's talk about how we're not solving the problem:

If you and I need to collaborate on a document _today_, what options do we have?

warm up discussion: consider these mechanisms for shared editing and limitations:

- dropbox
  - You have to trust dropbox to figure out conflicts for you and then hope they got it right
- email attachments
  - every email attachment of the document is a new, potentially authortiative copy and this gets increasingly confusing as you add collaborators
  - `doc_date_FINAL.docx`
- shared drive
  - typically only one person can modify the document at a time
- sharepoint
  - we may not have access to the same proprietary program for editing
  - depends on shared service access
- a google doc
  - google docs are pretty good, actually, until we start talking about code


what if you're working on code? what if your collaborators are strangers? what if they're halfway around the world?

plain text is a least common denominator
we're not assuming access to shared hardware
we are assuming that collaboration is async
:::

## on plain text

![beware](img/evernote.png)

::: notes
Be careful about storing valuable IP of yours in places that can take it away from you when they change business models
:::


## agenda

- terminology
- workflows: I
- tools
- workflows: II
- unhappy paths

# terminology

## git

_distributed_ version control system

::: notes
distributed = we all have a copy
contrast with other approaches where there is only one copy
:::

## repository

```shell
./
├── ChangeLog
├── config.site
├── configure*
├── configure.ac
├── configure.patch
├── COPYING
├── doc/
├── etc/
├── INSTALL
├── m4/
├── Makeconf.in
├── Makefile.fw
├── Makefile.in
├── po/
├── README
├── share/
├── src/
├── tests/
├── tools/
├── VERSION
└── VERSION-NICK
```

::: notes
a repository is a a project
opinions on the scope of what belongs in a single repository vary widely
monorepos?
:::

## remote

git vs. github / gitlab / bitbucket

::: notes
git is decentralized
github is how we coordinate
the authoritative copy is stored by the code host
:::

## commit

```{mermaid}
gitGraph
  commit id: "initial commit"
  commit id: "snapshot one"
  commit id: "snapshot two"
```

::: notes
a snapshot of project state
:::

## diff

```{mermaid}
gitGraph
  commit id: "initial commit"
  commit id: "snapshot one"
  commit id: "snapshot two"
```

::: notes
the difference between  _any_ two project snapshots
draw on the slides!
:::

# workflows: I


## new project

- create project (from rstudio, or terminal)

```bash
mkdir intro-git
cd intro-git
git init
```

::: notes
inspect the directory
hidden files
presence of `.git` is what makes it a repository
you can be a productive user of git without deeply understanding the contents of that directory
:::

## `git status`

run often

## `git status`

```bash
intro-git on  main
❯ git status
On branch main

No commits yet

nothing to commit (create/copy files and use "git add" to track)
```

## add some files

```bash
❯ git status
On branch main

No commits yet

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	_quarto.yml
	index.qmd

nothing added to commit but untracked files present (use "git add" to track)
```

## `git stage`

```bash
❯ git status
On branch main

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
	new file:   _quarto.yml
	new file:   index.qmd
```

::: notes
all the documentation you will ever see is for `git add`
:::


## new project, who dis


::: panel-tabset

### terminal

```bash
git config --global user.name edavidaja
git config --global user.email david@posit.cor
```

### R

```r
usethis::git_sitrep()
```

:::

## `git commit`


```bash
# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
#
# On branch main
#
# Initial commit
#
# Changes to be committed:
#       new file:   _quarto.yml
#       new file:   index.qmd
"~/Documents/projects/intro-git/.git/COMMIT_EDITMSG" 12L, 255B
```

## `EDITOR`

::: notes
### vim
normal mode
insert mode, write a message
`ESC` to return to normal mode
`:` to enter command mode
`wq` to write the file and quit

### nano

start typing
`CTRL + O` to save
`CTRL + X` to exit
:::

## `git commit -m`

```bash
❯ git commit -m "initial commit"
[main (root-commit) cab0112] initial commit
 2 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 _quarto.yml
 create mode 100644 index.qmd
```

## `git status`

```bash
❯ git status
On branch main
nothing to commit, working tree clean
```

## repeat

with rstudio, vscode

## `git log`

```bash
❯ git log
commit 3efdc26af7bf6ea223bfa61c6cb4507de632690e (HEAD -> main)
Author: edavidaja <edavidaja@hey.com>
Date:   Thu Jul 20 15:03:03 2023 -0400

    added vs code workspace

commit 0d98a3c9cf2a351da39b26adbfad442c834ff8d4
Author: edavidaja <edavidaja@hey.com>
Date:   Thu Jul 20 14:55:34 2023 -0400

    added rstudio project files

commit cab0112f6f96bdd82a46e622d8fccd445fc38d17
Author: edavidaja <edavidaja@hey.com>
Date:   Thu Jul 20 14:51:23 2023 -0400

    initial commit
```



## `git status`

```shell
❯ git status
On branch main
Your branch is up to date with 'origin/main'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   index.qmd

```


## publish to github

[existing project, github first](https://happygitwithr.com/existing-github-first.html)

## push

# tools

## `{prompt}`

https://github.com/gaborcsardi/prompt

## starship

https://starship.rs/

##  gh

https://cli.github.com/

## vs code

https://code.visualstudio.com/

# workflows: II

## gitignore

## clean

generated files chat

## branch

```{mermaid}
gitGraph
  commit
  commit
  commit
  branch experiment
  checkout experiment
  commit
```

## merge


```{mermaid}
gitGraph
  commit
  commit
  commit
  branch experiment
  checkout experiment
  commit
  checkout main
  merge experiment
```

## PRs

# unhappy paths

## merge conflicts

```{mermaid}
gitGraph
  commit
  commit
  commit
  branch experiment
  checkout experiment
  commit
  checkout main
  commit
```
